---
/**
 * @deprecated This component is deprecated. Use Header.astro from @/components/layout/Header.astro instead.
 *
 * Migration example:
 * ```astro
 * import Header from '@/components/layout/Header.astro';
 *
 * <Header
 *   position="fixed"
 *   size="lg"
 *   showCta
 *   cta={{ label: "View Docs", href: "https://docs.deployvelocity.com" }}
 *   extraNav={[{ label: "Features", href: "#features" }]}
 *   actions={[{ icon: "github", href: "...", iconOnly: true }]}
 * />
 * ```
 *
 * Navbar Component (DEPRECATED)
 * Dynamic navigation that reads routes from routes.ts
 * Routes with nav.show: true appear in the navigation
 */
import Button from '@/components/ui/form/Button/Button.astro';
import Icon from '@/components/ui/primitives/Icon/Icon.astro';
import Logo from '@/components/ui/marketing/Logo/Logo.astro';
import ThemeToggle from '@/components/layout/ThemeToggle.astro';
import { getNavRoutes } from '@/config/routes';

// Get navigation routes dynamically from routes.ts
const navRoutes = getNavRoutes();

// Check if we're on the landing page to determine link behavior
const currentPath = Astro.url.pathname;
const isLandingPage = currentPath === '/';

// Landing page specific links (anchor links)
const featuresLink = isLandingPage ? '#features' : '/#features';
const ctaLink = isLandingPage ? '#cta' : '/#cta';
---

<nav
  class="border-border bg-background/80 fixed top-0 right-0 left-0 z-50 border-b backdrop-blur-md"
>
  <div class="mx-auto flex h-16 max-w-6xl items-center justify-between px-6">
    <!-- Logo -->
    <a href="/" class="flex items-center gap-2">
      <Logo size="md" />
      <span class="font-display text-brand-500 text-xl font-bold tracking-tight">Velocity</span>
    </a>

    <!-- Desktop Menu -->
    <div class="hidden items-center gap-8 md:flex">
      <!-- Features link (anchor to landing page section) -->
      <a
        href={featuresLink}
        class="text-foreground-muted hover:text-foreground text-sm font-medium transition-colors"
      >
        Features
      </a>

      <!-- Dynamic navigation from routes.ts -->
      {
        navRoutes.map(({ path, label }) => (
          <a
            href={path}
            class="text-foreground-muted hover:text-foreground text-sm font-medium transition-colors"
          >
            {label}
          </a>
        ))
      }

      <div class="flex items-center gap-2">
        <ThemeToggle />
        <Button
          variant="ghost"
          size="sm"
          icon
          href="https://github.com/southwellmedia/velocity"
          target="_blank"
          aria-label="View on GitHub"
        >
          <Icon name="github" size="sm" />
        </Button>
        <Button size="sm" href={ctaLink} target="_blank">View Docs</Button>
      </div>
    </div>

    <!-- Mobile Toggle -->
    <button
      type="button"
      class="text-foreground hover:bg-secondary rounded-md p-2 transition-colors md:hidden"
      id="mobile-menu-toggle"
      aria-label="Toggle menu"
      aria-expanded="false"
    >
      <span class="menu-icon">
        <Icon name="menu" size="lg" />
      </span>
      <span class="close-icon hidden">
        <Icon name="x" size="lg" />
      </span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="bg-background border-border absolute top-16 left-0 hidden w-full flex-col gap-4 border-b p-6 shadow-lg md:hidden"
  >
    <!-- Features link (anchor to landing page section) -->
    <a
      href={featuresLink}
      class="text-foreground-secondary hover:text-foreground text-base font-medium transition-colors"
    >
      Features
    </a>

    <!-- Dynamic navigation from routes.ts -->
    {
      navRoutes.map(({ path, label }) => (
        <a
          href={path}
          class="text-foreground-secondary hover:text-foreground text-base font-medium transition-colors"
        >
          {label}
        </a>
      ))
    }

    <div class="border-border flex items-center gap-3 border-t pt-2">
      <ThemeToggle />
    </div>
    <Button fullWidth href={ctaLink} target="_blank">View Docs</Button>
  </div>
</nav>

<script>
  function initMobileMenu() {
    const toggle = document.getElementById('mobile-menu-toggle');
    const menu = document.getElementById('mobile-menu');
    const menuIcon = toggle?.querySelector('.menu-icon');
    const closeIcon = toggle?.querySelector('.close-icon');

    if (!toggle || !menu || !menuIcon || !closeIcon) return;

    toggle.addEventListener('click', () => {
      const isOpen = menu.classList.contains('hidden');

      if (isOpen) {
        menu.classList.remove('hidden');
        menu.classList.add('flex');
        menuIcon.classList.add('hidden');
        closeIcon.classList.remove('hidden');
        toggle.setAttribute('aria-expanded', 'true');
      } else {
        menu.classList.add('hidden');
        menu.classList.remove('flex');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        toggle.setAttribute('aria-expanded', 'false');
      }
    });

    // Close menu when clicking on links
    menu.querySelectorAll('a').forEach((link) => {
      link.addEventListener('click', () => {
        menu.classList.add('hidden');
        menu.classList.remove('flex');
        menuIcon.classList.remove('hidden');
        closeIcon.classList.add('hidden');
        toggle.setAttribute('aria-expanded', 'false');
      });
    });
  }

  initMobileMenu();
  document.addEventListener('astro:page-load', initMobileMenu);
</script>
